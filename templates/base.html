<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
  <link rel="shortcut icon" href="{{url_for('static', filename='/shark.png')}}">
  <link rel="stylesheet" href="{{url_for('static', filename='css/dashboard.css')}}">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VKN97VXE8T"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-VKN97VXE8T');
  </script>
  <!-- Google Ads -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7399184123120306"
     crossorigin="anonymous"></script>
  {% block head %}{% endblock %}
</head>
<body>
  <header class="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow">
    <button class="navbar-toggler me-0 d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <!-- Displaying Company name -->
    <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6" href="#">{{company}}</a>
    <!-- Nav bar -->
    <div class="navbar-nav">
      <div class="nav-item text-nowrap">
        <!-- Settings button at top right corner -->
        <button type="button" class="btn btn-dark" data-bs-toggle="dropdown" aria-expanded="false" data-bs-reference="parent">
          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-gear-wide-connected" viewBox="0 0 16 16">
<path d="M7.068.727c.243-.97 1.62-.97 1.864 0l.071.286a.96.96 0 0 0 1.622.434l.205-.211c.695-.719 1.888-.03 1.613.931l-.08.284a.96.96 0 0 0 1.187 1.187l.283-.081c.96-.275 1.65.918.931 1.613l-.211.205a.96.96 0 0 0 .434 1.622l.286.071c.97.243.97 1.62 0 1.864l-.286.071a.96.96 0 0 0-.434 1.622l.211.205c.719.695.03 1.888-.931 1.613l-.284-.08a.96.96 0 0 0-1.187 1.187l.081.283c.275.96-.918 1.65-1.613.931l-.205-.211a.96.96 0 0 0-1.622.434l-.071.286c-.243.97-1.62.97-1.864 0l-.071-.286a.96.96 0 0 0-1.622-.434l-.205.211c-.695.719-1.888.03-1.613-.931l.08-.284a.96.96 0 0 0-1.186-1.187l-.284.081c-.96.275-1.65-.918-.931-1.613l.211-.205a.96.96 0 0 0-.434-1.622l-.286-.071c-.97-.243-.97-1.62 0-1.864l.286-.071a.96.96 0 0 0 .434-1.622l-.211-.205c-.719-.695-.03-1.888.931-1.613l.284.08a.96.96 0 0 0 1.187-1.186l-.081-.284c-.275-.96.918-1.65 1.613-.931l.205.211a.96.96 0 0 0 1.622-.434l.071-.286zM12.973 8.5H8.25l-2.834 3.779A4.998 4.998 0 0 0 12.973 8.5zm0-1a4.998 4.998 0 0 0-7.557-3.779l2.834 3.78h4.723zM5.048 3.967c-.03.021-.058.043-.087.065l.087-.065zm-.431.355A4.984 4.984 0 0 0 3.002 8c0 1.455.622 2.765 1.615 3.678L7.375 8 4.617 4.322zm.344 7.646.087.065-.087-.065z"/>
          </svg>
          <span class="visually-hidden">Toggle Dropdown</span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end" style="position: absolute; transform: translateX(-10px);">
          <li>
            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#profileModal">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
<path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"/>
              </svg>
              Profile
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#passwordModal">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shield-lock" viewBox="0 0 16 16">
<path d="M5.338 1.59a61.44 61.44 0 0 0-2.837.856.481.481 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.725 10.725 0 0 0 2.287 2.233c.346.244.652.42.893.533.12.057.218.095.293.118a.55.55 0 0 0 .101.025.615.615 0 0 0 .1-.025c.076-.023.174-.061.294-.118.24-.113.547-.29.893-.533a10.726 10.726 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.775 11.775 0 0 1-2.517 2.453 7.159 7.159 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7.158 7.158 0 0 1-1.048-.625 11.777 11.777 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 62.456 62.456 0 0 1 5.072.56z"/>
<path d="M9.5 6.5a1.5 1.5 0 0 1-1 1.415l.385 1.99a.5.5 0 0 1-.491.595h-.788a.5.5 0 0 1-.49-.595l.384-1.99a1.5 1.5 0 1 1 2-1.415z"/>
              </svg>
              Change password
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#referModal">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-wallet2" viewBox="0 0 16 16">
<path d="M12.136.326A1.5 1.5 0 0 1 14 1.78V3h.5A1.5 1.5 0 0 1 16 4.5v9a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 13.5v-9a1.5 1.5 0 0 1 1.432-1.499L12.136.326zM5.562 3H13V1.78a.5.5 0 0 0-.621-.484L5.562 3zM1.5 4a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-13z"/>
              </svg>
              Refer & Earn
            </a>
          </li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="w-100 btn btn-danger" href="/logout">Sign out</a></li>
        </ul>
      </div>
    </div>
  </header>
  <!-- Giving spacing -->
  <div style="height:49px"></div>
  <div class="container-fluid">
    <div class="row">
      <!-- Siderbar Menu  -->
      <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
        <div class="position-sticky pt-3 sidebar-sticky">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" id="dashboard" aria-current="page" href="/dashboard/today">
                <span data-feather="home" class="align-text-bottom"></span>
                Dashboard
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="sales" href="/sales/thisweek">
                <span data-feather="file" class="align-text-bottom"></span>
                Sales
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="products" href="/products">
                <span data-feather="shopping-cart" class="align-text-bottom"></span>
                Products
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="customers" href="/customers">
                <span data-feather="users" class="align-text-bottom"></span>
                Customers
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="wholesalers" href="/wholesalers">
                <span data-feather="shopping-bag" class="align-text-bottom"></span>
                Wholesalers
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="ledgers" href="/ledgers/thisweek">
                <span data-feather="book" class="align-text-bottom"></span>
                Ledgers
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="expenses" href="/expenses/thisweek">
                <span data-feather="bar-chart-2" class="align-text-bottom"></span>
                Expenses
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="replacements" href="/replacements/thisweek">
                <span data-feather="layers" class="align-text-bottom"></span>
                Replacements
              </a>
            </li>
          </ul>
          <footer class="my-5 pt-5 text-muted text-center text-small">
            <img src="/static/shark.png" class="img-fluid animated d-inline align-middle" alt="" width="40" height="40">
            <p class="fs-3 d-inline align-middle" style="margin-left: 10px;"><strong>FinCheck</strong></p>
          </footer>
        </div>
      </nav>
      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4" id="dashboardSection">
        {% block main %}{% endblock %}
      </main>
    </div>
  </div>
  <!-- End of container -->
  <!-- Change Password Modal -->
  <div class="modal fade" id="passwordModal" tabindex="-1" aria-labelledby="passwordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="passwordModalLabel">Change Password</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="/change-password" method="POST">
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">Old Password:</label>
              <input type="text" class="form-control" name="old-pass" id="old-pass">
            </div>
            <div class="mb-3">
              <label for="message-text" class="col-form-label">New Password:</label>
              <input type="password" class="form-control" name="new-pass" id="new-pass">
            </div>
            <div class="mb-3">
              <label for="message-text" class="col-form-label">Confirm New Password:</label>
              <input type="password" class="form-control" name="re-new-pass" id="re-new-pass">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button class="btn btn-primary" type="submit">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!-- Profile Modal -->
  <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="profileModalLabel">Profile Details</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6>Username: <span class="text-muted">{{username}}</span></h6>
          <h6>Company: <span class="text-muted">{{company}}</span></h6>
          <h6>Email Address: 
            <span class="text-muted">{{email}} 
              <span class="badge rounded-pill text-bg-primary text-right" data-bs-toggle="modal" data-bs-target="#updateEmailModal">Update</span>
            </span>
          </h6>
          <h6>Subscription: <span class="text-muted">Valid till {{subs_end}}</span></h6>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Update Email Modal -->
  <div class="modal fade" id="updateEmailModal" tabindex="-1" aria-labelledby="updateEmailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="updateEmailModalLabel">Update Email Address</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="/update-email" method="POST">
            <div class="mb-3">
              <label for="new-email" class="col-form-label">Email Address</label>
              <input type="email" class="form-control" name="new-email" id="new-email">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button class="btn btn-primary" type="submit">Get OTP</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!-- Referral Modal -->
  <div class="modal fade" id="referModal" tabindex="-1" aria-labelledby="referModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="referModalLabel">Refer & Earn</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6>Your unique referral code is: <span class="text-muted">{{referral_code}}</h6>
          <h7>Ask your known ones to buy a subscription and get &#x20b9;50/- discount on your next subscription for each user who joins using your code</h7>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.8/xlsx.full.min.js"></script>
  <!-- JavaScript code to handle the excel download -->
  <script>
  function downloadAsXLSX() {
    // Create a new workbook
    var workbook = XLSX.utils.book_new();
    // Loop through each HTML table and add it as a sheet to the workbook
    var tables = document.getElementsByTagName("table");
    for (var i = 0; i < tables.length; i++) {
      var table = tables[i];
      var worksheet = XLSX.utils.table_to_sheet(table);
      XLSX.utils.book_append_sheet(workbook, worksheet, "Sheet" + (i + 1));
    }
    // Save the workbook as an XLSX file
    var filename = "tables.xlsx";
    XLSX.writeFile(workbook, filename);
  }
  </script>
  
  <!-- JavaScript code to handle the screenshot download -->
  <script>
    document.getElementById("exportButton").addEventListener("click", function() {
      // Capture the desired part of the screen
      html2canvas(document.getElementById("dashboardSection")).then(function(canvas) {
        // Convert the canvas to a blob object
        canvas.toBlob(function(blob) {
          // Create a download link
          var link = document.createElement("a");
          link.download = "screenshot.png";
          link.href = URL.createObjectURL(blob);
          // Click the link to trigger the download
          link.click();
        });
      });
    });
  </script>
  
  <!-- To select the time filter option  -->
  <script>
    const dropdownSelected = document.getElementById('dropdownSelected');
    const dropdownMenu = document.getElementById('dropdownMenu');
    // Get the current URL path
    const currentPath = window.location.pathname;
    // Find the matching dropdown item based on the current URL
    const matchingItem = [...dropdownMenu.children].find(item => {
      const link = item.querySelector('a');
      return link && link.getAttribute('href') === currentPath;
    });
    // Update the dropdown button text to the matching item
    if (matchingItem) {
      dropdownSelected.textContent = matchingItem.querySelector('a').textContent;
    }
    dropdownMenu.addEventListener('click', (event) => {
      // Get the text content of the clicked item
      const selectedItem = event.target.textContent;
      // Update the dropdown button text to the selected item
      dropdownSelected.textContent = selectedItem;
      // Allow the default link behavior for the selected item
      const selectedLink = event.target.closest('a');
      if (selectedLink) {
        selectedLink.click();
      }
    });
  </script>
  {% block script %}{% endblock %}
</body>
</html>